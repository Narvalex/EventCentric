using EventCentric.Log;
using EventCentric.Polling;
using System.Web.Http;
using System.Web.Http.Cors;

namespace EventCentric.Heartbeating
{
    [EnableCors(origins: "*", headers: "*", methods: "*")]
    public class HeartbeatController : ApiController
    {
        private readonly INode node;
        private readonly ILogger log;
        private readonly IMonitoredSubscriber subscriber;

        public HeartbeatController(INode node, ILogger log, IMonitoredSubscriber subscriber)
        {
            this.node = node;
            this.log = log;
            this.subscriber = subscriber;
        }

        // GET: Heartbeat
        [HttpGet]
        [Route("heartbeat")]
        public IHttpActionResult Get()
        {
            string responseText = HeartbeatEmitter.GetHeartbeat(this.node, this.log, this.subscriber);

            return this.Ok(responseText);
        }
    }
}
